<!DOCTYPE html>
<html lang="fr" class="h-full bg-gray-900">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notre hydroponie</title>
    <!-- Tailwind CSS for a lightweight, modern UI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter for clean typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icons from Lucide for better visual cues -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Use the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Custom styles for a toggle switch feel */
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-on {
            background-color: #34D399; /* Green 400 */
        }
        
        .status-off {
            background-color: #F87171; /* Red 400 */
            animation: none;
        }
        
        .status-loop-on {
             background-color: #60A5FA; /* Blue 400 */
        }
        
        .status-loop-off {
            background-color: #9CA3AF; /* Gray 400 */
            animation: none;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>

<body class="h-full text-white">
    <div class="min-h-full flex items-center justify-center p-4">
        <main class="w-full max-w-2xl mx-auto">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-100 flex items-center justify-center">
                    <i data-lucide="droplet" class="mr-3 h-8 w-8 text-blue-400"></i>
                    Notre hydroponie
                </h1>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <!-- Status Panel -->
                <div class="bg-gray-800 p-6 rounded-2xl col-span-1 md:col-span-2 shadow-lg">
                    <h2 class="text-xl font-semibold mb-4 flex items-center"><i data-lucide="activity" class="mr-2 h-5 w-5 text-gray-300"></i>Statut Actuel</h2>
                    <div class="space-y-3">
                        <!-- NOTE: Replace static text with your template variables -->
                        <div class="flex justify-between items-center bg-gray-700/50 p-3 rounded-lg">
                            <span class="font-medium text-gray-300">Statut Pompe</span>
                            <div class="flex items-center font-bold">
                                <span class="status-indicator status-on"></span>
                                <span class="text-green-400">ALLUMÉ</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center bg-gray-700/50 p-3 rounded-lg">
                            <span class="font-medium text-gray-300">Statut Boucle</span>
                            <div class="flex items-center font-bold">
                                <span class="status-indicator status-loop-on"></span>
                                <span class="text-blue-400">EN COURS</span>
                            </div>
                        </div>
                        <div class="space-y-3 pt-2">
                             <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-400">Prochain Démarrage</span>
                                <span class="font-mono text-gray-200">-- min</span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-400">Prochain Arrêt</span>
                                <span class="font-mono text-gray-200">2 min</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manual Control -->
                <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                    <h2 class="text-xl font-semibold mb-4 flex items-center"><i data-lucide="toggle-right" class="mr-2 h-5 w-5 text-gray-300"></i>Contrôle Manuel</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <form action="/on" method="post">
                            <button type="submit" class="w-full flex items-center justify-center p-4 bg-green-600 hover:bg-green-700 rounded-lg font-bold transition-all duration-200 ease-in-out transform hover:scale-105">
                                <i data-lucide="power-on" class="mr-2 h-5 w-5"></i>Allumer
                            </button>
                        </form>
                        <form action="/off" method="post">
                             <button type="submit" class="w-full flex items-center justify-center p-4 bg-red-600 hover:bg-red-700 rounded-lg font-bold transition-all duration-200 ease-in-out transform hover:scale-105">
                                <i data-lucide="power-off" class="mr-2 h-5 w-5"></i>Éteindre
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Automatic Loop Control -->
                <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                    <h2 class="text-xl font-semibold mb-4 flex items-center"><i data-lucide="repeat" class="mr-2 h-5 w-5 text-gray-300"></i>Boucle Automatique</h2>
                    <!-- NOTE: Your backend should populate the data-* attributes with the last known values in SECONDS. -->
                    <!-- Example: data-interval-seconds="{{ interval }}" data-duration-seconds="{{ on_time }}" -->
                    <form action="/start-loop" method="post" class="space-y-4" id="loop-form"
                        data-interval-seconds="" 
                        data-duration-seconds="">
                        <div>
                            <label for="interval_minutes" class="block text-sm font-medium text-gray-300 mb-1">Temps d'attente (minutes)</label>
                            <input type="number" id="interval_minutes" required class="w-full bg-gray-700 border-gray-600 text-white rounded-lg p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        </div>
                        <div>
                            <label for="duration_minutes" class="block text-sm font-medium text-gray-300 mb-1">Durée d'activité (minutes)</label>
                            <input type="number" id="duration_minutes" required class="w-full bg-gray-700 border-gray-600 text-white rounded-lg p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        </div>
                        
                        <!-- Hidden fields that will be sent to the server with values in seconds -->
                        <input type="hidden" name="interval" id="interval_seconds">
                        <input type="hidden" name="duration" id="duration_seconds">

                        <button type="submit" class="w-full p-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold transition-all duration-200 ease-in-out transform hover:scale-105 flex items-center justify-center">
                            <i data-lucide="play-circle" class="mr-2 h-5 w-5"></i>Démarrer la Boucle
                        </button>
                    </form>
                    <form action="/stop-loop" method="post" class="mt-4">
                        <button type="submit" class="w-full p-3 bg-yellow-600 hover:bg-yellow-700 text-black rounded-lg font-bold transition-all duration-200 ease-in-out transform hover:scale-105 flex items-center justify-center">
                           <i data-lucide="stop-circle" class="mr-2 h-5 w-5"></i>Arrêter la Boucle
                        </button>
                    </form>
                </div>

            </div>
        </main>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // This function runs when the page content is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const loopForm = document.getElementById('loop-form');
            const intervalInput = document.getElementById('interval_minutes');
            const durationInput = document.getElementById('duration_minutes');

            // Get the previous values (in seconds) from the data attributes
            const intervalSeconds = loopForm.dataset.intervalSeconds;
            const durationSeconds = loopForm.dataset.durationSeconds;

            // If a previous interval value exists, convert it to minutes and set the input's value
            if (intervalSeconds && !isNaN(intervalSeconds)) {
                intervalInput.value = Math.round(parseInt(intervalSeconds, 10) / 60);
            } else {
                // Otherwise, set a default placeholder
                intervalInput.placeholder = 'ex: 60';
            }

            // If a previous duration value exists, convert it to minutes and set the input's value
            if (durationSeconds && !isNaN(durationSeconds)) {
                durationInput.value = Math.round(parseInt(durationSeconds, 10) / 60);
            } else {
                 // Otherwise, set a default placeholder
                durationInput.placeholder = 'ex: 2';
            }
        });

        // Target the form for starting the loop
        const loopForm = document.getElementById('loop-form');

        // Listen for the form's submit event to convert minutes back to seconds
        loopForm.addEventListener('submit', function(event) {
            // Get the values the user entered in minutes
            const intervalMinutes = document.getElementById('interval_minutes').value;
            const durationMinutes = document.getElementById('duration_minutes').value;

            // Convert the minute values to seconds
            const intervalSeconds = intervalMinutes * 60;
            const durationSeconds = durationMinutes * 60;

            // Set the calculated second values on the hidden input fields
            document.getElementById('interval_seconds').value = intervalSeconds;
            document.getElementById('duration_seconds').value = durationSeconds;

            // The form will now submit with the hidden fields 'interval' and 'duration'
            // containing the correct second values.
        });
    </script>
</body>

</html>
